//Parent and Child processes communicating via shared memory

#include <sys/types.h>
#include <sys/ipc.h>
#include <sys/shm.h>
int main(void)
{
int shmid;
char *shmPtr;
int n;
if (fork( ) == 0)
{
sleep(5); /* UUPS */
if( (shmid = shmget(2041, 32, 0)) == -1 )
{

exit(1);
}
shmPtr = shmat(shmid, 0, 0);
if (shmPtr == (char *) -1)
exit(2);
printf ("\nChild Reading ....\n\n");
for (n = 0; n < 26; n++)
putchar(shmPtr[n]);
putchar('\n'); }
else
{
if( (shmid = shmget(2041, 32, 0666 | IPC_CREAT)) == -1 )
{
exit(1);
}
shmPtr = shmat(shmid, 0, 0);
if (shmPtr == (char *) -1)
exit(2);
for (n = 0; n < 26; n++)
shmPtr[n] = 'a' + n;
printf ("Parent Writing ....\n\n") ;
for (n = 0; n < 26; n++)
putchar(shmPtr[n]);
putchar('\n'); wait(NULL);
shmdt(NULL);
if( shmctl(shmid, IPC_RMID, NULL) == -1 )
{
perror("shmctl");
exit(-1);
}
}
exit(0);
}

//3 Process writing and reading

/* process1.c */
#include <sys/types.h>
#include <sys/ipc.h>
#include <sys/shm.h>
#include <stdio.h>
#define SHMSIZE 27
main()
{
char c;
int shmid;
key_t key;
char *shm, *s;
/*
* We'll name our shared memory segment
* "5678".
*/
key = 5678;
/*
* Create the
segment. */
if ((shmid = shmget(key, SHMSIZE, IPC_CREAT | 0666)) < 0)
{ perror("shmget");
exit(1);
}
/*
* Now we attach the segment to our data space.
*/
if ((shm = shmat(shmid, NULL, 0)) == (char *) -1)
{ perror("shmat");
exit(1);
}
/*
* Now put 1 in first
place */
s=shm;
*s++='1';
*s=NULL;
printf("Process1:- I have put the message %s\n",shm);
/*
* Finally, we wait until the other process

* changes the first character of our memory
*/
while (*shm != '2' && *shm+6 != 'o')
sleep(1);
printf("Process1:- Process2 has put the message
%s\n",shm); while (*shm != '3' && *shm+7 != 'y')
sleep(1);
printf("Process1:- Process3 has put the message %s\n",shm);
printf("Process1:- I am quiting\n");
exit(0);
}
/* process2.c */
#include <sys/types.h>
#include <sys/ipc.h>
#include <sys/shm.h>
#include <stdio.h>
#define SHMSIZE 27
main()
{
char c;
int shmid;
key_t key;
char *shm;
/*
* We'll name our shared memory segment.
*/
key = 5678;
/*
* Create the segment.
*/
if ((shmid = shmget(key, SHMSIZE, 0666)) < 0)
{ perror("shmget");
exit(1);
}
/*
* Now we attach the segment to our data space.
*/
if ((shm = shmat(shmid, NULL, 0)) == (char *) -1)
{ perror("shmat");
exit(1);
}
/*

* Now put 1 in first
place */
*shm++='2';
*shm++=' ';
*shm++='h';
*shm++='e';
*shm++='l';
*shm++='l';
*shm++='o';
*shm = NULL;
exit(0);
}
/* process3.c */
#include <sys/types.h>
#include <sys/ipc.h>
#include <sys/shm.h>
#include <stdio.h>
#define SHMSIZE 27
main()
{
char c;
int shmid;
key_t key;
char *shm, *s;
/*
* We'll name our shared memory segment.
*/
key = 5678;
/*
* Create the
segment. */
if ((shmid = shmget(key, SHMSIZE, 0666)) < 0)
{ perror("shmget");
exit(1);
}
/*
* Now we attach the segment to our data space.
*/
if ((shm = shmat(shmid, NULL, 0)) == (char *) -1)
{ perror("shmat");
exit(1);
}
/*
* Now put 1 in first place

*/
*shm++='3';
*shm++=' ';
*shm++='m';
*shm++='e';
*shm++='m';
*shm++='o';
*shm++='r';
*shm++='y';
*shm = NULL;
exit(0);
}
